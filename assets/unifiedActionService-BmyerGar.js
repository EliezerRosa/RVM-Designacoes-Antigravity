import{s as g,a as h,g as m,E as s,c as A,w}from"./index-CZWnHhoy.js";const _={async executeDesignation(a,i,e,o){console.log("[UnifiedAction] üìù Solicita√ß√£o de Designa√ß√£o:",{partId:a,publisherName:i,source:e,reason:o});try{e==="AGENT"&&await this.validateEligibility(a,i);const r=await w.proposePublisher(a,i);return console.log(`[UnifiedAction] ‚úÖ Sucesso: ${i} designado para ${r.tituloParte} (${e})`),{success:!0,part:r}}catch(r){return console.error("[UnifiedAction] ‚ùå Falha:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido na designa√ß√£o"}}},async revertDesignation(a,i,e="Revertido pelo usu√°rio"){console.log("[UnifiedAction] ‚Ü©Ô∏è Solicita√ß√£o de Revers√£o:",{partId:a,source:i,reason:e});try{const o=await w.rejectProposal(a,e);return console.log(`[UnifiedAction] ‚úÖ Revertido com sucesso: ${o.tituloParte}`),{success:!0,part:o}}catch(o){return console.error("[UnifiedAction] ‚ùå Falha na revers√£o:",o),{success:!1,error:o instanceof Error?o.message:"Erro desconhecido na revers√£o"}}},async validateEligibility(a,i){const{data:e,error:o}=await g.from("workbook_parts").select("week_id, seq, tipo_parte, modalidade, date, section, funcao").eq("id",a).single();if(o||!e)throw new Error(`Parte n√£o encontrada: ${a}`);const r=await h.loadPublishers(),n=r.find(t=>t.name===i);if(!n)throw new Error(`Publicador n√£o encontrado: "${i}"`);const c=e.tipo_parte||"",p=e.modalidade||m(c),l=e.funcao==="Ajudante"?s.AJUDANTE:s.TITULAR,v=c.toLowerCase().includes("inicial"),E=!1;let d;if(l===s.AJUDANTE){const{data:t}=await g.from("workbook_parts").select("resolved_publisher_name").eq("week_id",e.week_id).eq("seq",e.seq).eq("funcao","Titular").maybeSingle();if(t?.resolved_publisher_name){const f=r.find(b=>b.name===t.resolved_publisher_name);f&&(d=f.gender)}}const u=A(n,p,l,{date:e.date,isOracaoInicial:v,secao:e.section,isPastWeek:E,titularGender:d});if(!u.eligible)throw new Error(`[Safety Block] Publicador Ineleg√≠vel: ${u.reason}`)}};export{_ as unifiedActionService};
