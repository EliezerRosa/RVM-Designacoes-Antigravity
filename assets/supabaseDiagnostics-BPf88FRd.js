import{s as f}from"./index-B-JYc925.js";function g(s){if(!s)return{code:"UNKNOWN",message:"Unknown error",details:null,hint:null};if(typeof s=="object"&&s!==null){const t=s;return{code:t.code||"UNKNOWN",message:t.message||String(s),details:t.details||null,hint:t.hint||null,httpStatus:t.status,postgrestCode:t.code}}return{code:"UNKNOWN",message:String(s),details:null,hint:null}}function d(s){let t=`‚ùå [${s.code}] ${s.message}`;return s.details&&(t+=`
   Detalhes: ${s.details}`),s.hint&&(t+=`
   Sugest√£o: ${s.hint}`),s.httpStatus&&(t+=`
   HTTP Status: ${s.httpStatus}`),t}async function $(s,t,i){const u=i.chunkSize||500,n=[];for(let o=0;o<t.length;o+=u)n.push(t.slice(o,o+u));const e={totalChunks:n.length,completedChunks:0,totalRows:t.length,insertedRows:0,failedRows:0,errors:[],startTime:Date.now()};console.log(`[Supabase] üì¶ Iniciando upload: ${t.length} rows em ${n.length} chunks de ${u}`);for(let o=0;o<n.length;o++){const l=n[o];e.currentChunkStartTime=Date.now(),console.log(`[Supabase] üì§ Chunk ${o+1}/${n.length} (${l.length} rows)...`);try{const{error:r}=await f.from(s).upsert(l,{onConflict:i.onConflict,ignoreDuplicates:!1}),a=Date.now()-e.currentChunkStartTime;if(r){const h=g(r);e.errors.push(h),e.failedRows+=l.length,console.error(`[Supabase] ‚ùå Chunk ${o+1} falhou (${a}ms):`,d(h))}else e.insertedRows+=l.length,console.log(`[Supabase] ‚úÖ Chunk ${o+1} OK (${a}ms, total: ${e.insertedRows}/${e.totalRows})`)}catch(r){const a=g(r);e.errors.push(a),e.failedRows+=l.length,console.error(`[Supabase] ‚ùå Chunk ${o+1} exce√ß√£o:`,d(a))}e.completedChunks++,i.onProgress&&i.onProgress({...e})}const c=Date.now()-e.startTime;return console.log(`[Supabase] üìä Upload conclu√≠do em ${c}ms`),console.log(`   ‚úÖ Inseridos: ${e.insertedRows}/${e.totalRows}`),console.log(`   ‚ùå Falhas: ${e.failedRows}`),console.log(`   ‚ö†Ô∏è Erros: ${e.errors.length}`),{success:e.failedRows===0,totalInserted:e.insertedRows,totalFailed:e.failedRows,errors:e.errors,durationMs:c}}export{d as formatErrorForDisplay,g as parseSupabaseError,$ as upsertWithDiagnostics};
